<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Lightweight Authorization for Authenticated Key Exchange.</title>
<meta content="Göran Selander" name="author">
<meta content="John Mattsson" name="author">
<meta content="Malisa Vucinic" name="author">
<meta content="Michael Richardson" name="author">
<meta content="
       This document describes a procedure for augmenting an authenticated Diffie-Hellman key exchange with third party assisted authorization targeting constrained IoT deployments (RFC 7228). 
    " name="description">
<meta content="xml2rfc 2.37.3" name="generator">
<meta content="draft-selander-ace-ake-authz-latest" name="ietf.draft">
<link href="draft-selander-ace-ake-authz.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@import url('https://martinthomson.github.io/i-d-template/fonts.css');

html {
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --small-font-size: 14.5px;
}
body {
  max-width: 624px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
#title {
  padding: 1em 0 0.2em;
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1, h2, h3 {
  font-size: 22px;
  line-height: 26px;
}
h4, h5, h6 {
  font-size: 18px;
  line-height: 22px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p, #abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 18px;
  line-height: 24px;
}
p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href].selfRef {
  color: var(--text-color);
}
a[href] {
  color: var(--link-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px 'Oxygen Mono', monospace;
}
pre {
  border: 1px solid var(--line-color);
  line-height: 17px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  pre {
    display: inline-block;
    overflow-x: auto;
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  pre + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #eee;
}
tr:nth-child(2n) > td {
  background-color: var(--background-color);
}
tr:nth-child(2n+1) > td {
  background-color: var(--highlight-color);
}
thead+tbody tr:nth-child(2n) > td {
  background-color: var(--highlight-color);
}
thead+tbody tr:nth-child(2n+1) > td {
  background-color: var(--background-color);
}
table caption {
  font-style: italic;
  margin: 0.3em 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  visibility: hidden;
  user-select: none;
}
a.pilcrow[href] { color: #ddd; }
a.pilcrow[href]:hover { text-decoration: none; }
@media screen {
  :hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 8em;
}
#identifiers dt {
  width: var(--identifier-width);
  margin: 0;
  clear: left;
  float: left;
  text-align: right;
}
#identifiers dd {
  margin: 0 0 0 calc(1em + var(--identifier-width));
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    column-count: 2;
    column-gap: 20px;
  }
  .index ul ul {
    column-count: 1;
    column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 600px) {
  #authors-addresses {
    display: relative;
    padding: 32px 0 0;
    column-count: 2;
    column-gap: 20px;
  }
  #name-authors-addresses {
    position: absolute;
    top: 0px;
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
  }
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #b76427;
  background-color: rgba(249, 232, 105, 0.3);
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: rgba(249, 232, 105, 0.3);
  border-radius: 3px;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 953px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 954px) {
  body {
    padding-right: 380px;
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul p, #toc ul li {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  dd {
    page-break-before: avoid;
  }
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Lightweight Authorization for AKE.</td>
<td class="right">February 2020</td>
</tr></thead>
<tfoot><tr>
<td class="left">Selander, et al.</td>
<td class="center">Expires 23 August 2020</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-selander-ace-ake-authz-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2020-02-20" class="published">20 February 2020</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2020-08-23">23 August 2020</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">G. Selander</div>
<div class="org">Ericsson AB</div>
</div>
<div class="author">
      <div class="author-name">J. Mattsson</div>
<div class="org">Ericsson AB</div>
</div>
<div class="author">
      <div class="author-name">M. Vucinic</div>
<div class="org">INRIA</div>
</div>
<div class="author">
      <div class="author-name">M. Richardson</div>
<div class="org">Sandelman Software Works</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Lightweight Authorization for Authenticated Key Exchange.</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document describes a procedure for augmenting an authenticated Diffie-Hellman key exchange with third party assisted authorization targeting constrained IoT deployments (RFC 7228).<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note" id="section-note.1">
      <h2 id="name-note-to-readers">
<a href="#name-note-to-readers" class="section-name selfRef">Note to Readers</a>
      </h2>
<p id="section-note.1-1">Source for this draft and an issue tracker can be found at
  <a href="https://github.com/EricssonResearch/ace-ake-authz">https://github.com/EricssonResearch/ace-ake-authz</a>.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 23 August 2020.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2020 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a><a href="#section-toc.1-1.1.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-terminology" class="xref">Terminology</a><a href="#section-toc.1-1.1.2.1.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-problem-description" class="xref">Problem Description</a><a href="#section-toc.1-1.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-assumptions" class="xref">Assumptions</a><a href="#section-toc.1-1.3.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-device" class="xref">Device</a><a href="#section-toc.1-1.3.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-domain-authenticator" class="xref">Domain Authenticator</a><a href="#section-toc.1-1.3.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-authorization-server" class="xref">Authorization Server</a><a href="#section-toc.1-1.3.2.3.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="xref">3.4</a>.  <a href="#name-lightweight-ake" class="xref">Lightweight AKE</a><a href="#section-toc.1-1.3.2.4.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-the-protocol" class="xref">The Protocol</a><a href="#section-toc.1-1.4.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-device-authorization-server" class="xref">Device &lt;-&gt; Authorization Server</a><a href="#section-toc.1-1.4.2.1.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-device-authenticator" class="xref">Device &lt;-&gt; Authenticator</a><a href="#section-toc.1-1.4.2.2.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-authenticator-authorization" class="xref">Authenticator &lt;-&gt; Authorization Server</a><a href="#section-toc.1-1.4.2.3.1" class="pilcrow">¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-ace-profile" class="xref">ACE Profile</a><a href="#section-toc.1-1.5.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a><a href="#section-toc.1-1.6.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a><a href="#section-toc.1-1.7.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-informative-references" class="xref">Informative References</a><a href="#section-toc.1-1.8.1" class="pilcrow">¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-appendix.a" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a><a href="#section-toc.1-1.9.1" class="pilcrow">¶</a></p>
</li>
</ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">For constrained IoT deployments <span>[<a href="#RFC7228" class="xref">RFC7228</a>]</span> the overhead contributed by security protocols may be significant which motivates the specification of lightweight protocols that are optimizing, in particular, message overhead (see <span>[<a href="#I-D.ietf-lake-reqs" class="xref">I-D.ietf-lake-reqs</a>]</span>).
This document describes a lightweight procedure for augmenting an authenticated Diffie-Hellman key exchange with third party assisted authorization.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">The procedure involves a device, a domain authenticator and an authorization server.
The device and authenticator performs mutual authentication and authorization, assisted by the authorization server which provides relevant authorization information to the device (a "voucher") and the authenticator.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">The protocol specified in this document optimizes the message count by performing authorization and enrolment in parallel with authentication, instead of in sequence which is common for network access.
It further reuses protocol elements from the authentication protocol leading to reduced message sizes on constrained links.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">The specification assumes a lightweight AKE protocol <span>[<a href="#I-D.ietf-lake-reqs" class="xref">I-D.ietf-lake-reqs</a>]</span> between device and authenticator, and defines the integration of a lightweight authorization procedure.
This enables a secure target interaction in few message exchanges.
In this document we consider the target interaction to be "enrolment", for example certificate enrolment (such as <span>[<a href="#I-D.ietf-ace-coap-est" class="xref">I-D.ietf-ace-coap-est</a>]</span>) or joining a network for the first time (e.g. <span>[<a href="#I-D.ietf-6tisch-minimal-security" class="xref">I-D.ietf-6tisch-minimal-security</a>]</span>), but it can be applied to authorize other target interactions.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">This protocol is applicable in a wide variety of settings, and can be mapped to different authorization architectures.
This document specifies a profile of the ACE framework <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>.
This document does not deal with any mapping to an EAP setting.<a href="#section-1-5" class="pilcrow">¶</a></p>
<div id="terminology">
<section id="section-1.1">
        <h3 id="name-terminology">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="prob-desc">
<section id="section-2">
      <h2 id="name-problem-description">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-problem-description" class="section-name selfRef">Problem Description</a>
      </h2>
<p id="section-2-1">The (potentially constrained) device wants to enrol into a domain over a constrained link.
The device authenticates and enforces authorization of the (non-constrained) domain authenticator with the help of a voucher, and makes the enrolment request.
The domain authenticator authenticates the device and authorizes its enrolment.
Authentication between device and domain authenticator is made with a lightweight authenticated Diffie-Hellman key exchange protocol (LAKE, <span>[<a href="#I-D.ietf-lake-reqs" class="xref">I-D.ietf-lake-reqs</a>]</span>).
The procedure is assisted by a (non-constrained) authorization server located in a non-constrained network behind the domain authenticator providing information to the device and to the domain authenticator.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">The objective of this document is to specify such a protocol which is lightweight over the constrained link and reuses elements of the LAKE. See illustration in <a href="#fig-overview" class="xref">Figure 1</a>.<a href="#section-2-2" class="pilcrow">¶</a></p>
<span id="name-overview-and-example-of-mes"></span><div id="fig-overview">
<figure id="figure-1">
        <div class="artwork art-text alignCenter" id="section-2-3.1">
<pre>
                   Voucher
              LAKE  Info
+------------+  |    |   +---------------+  Voucher  +--------------+
|            |  |    |   |               |  Request  |              |
|   Device   |--|----o--&gt;|    Domain     |----------&gt;|Authorization |
|            |&lt;-|---o----| Authenticator |&lt;----------|    Server    |
|     (U)    |--|---|---&gt;|      (V)      |  Voucher  |      (W)     |
|            |      |    |               |  Response |              |
+------------+      |    +---------------+           +--------------+
                  Voucher


</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-overview-and-example-of-mes" class="selfRef">Overview and example of message content. Voucher Info and Voucher are sent together with LAKE messages.</a>
        </figcaption></figure>
</div>
</section>
</div>
<div id="assumptions">
<section id="section-3">
      <h2 id="name-assumptions">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-assumptions" class="section-name selfRef">Assumptions</a>
      </h2>
<div id="device">
<section id="section-3.1">
        <h3 id="name-device">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-device" class="section-name selfRef">Device</a>
        </h3>
<p id="section-3.1-1">The device is pre-provisioned with an identity ID and asymmetric key credentials: a private key, a public key (PK_U), and optionally a public key certificate Cert(PK_U), issued by a trusted third party such as e.g. the device manufacturer, used to authenticate to the domain authenticator. The ID may be a reference or pointer to the certificate.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">The device is also provisioned with information about its authorization server:<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-3.1-3.1">At least one static public DH key of the authorization server (G_W) used to ensure secure communication with the device (see <a href="#U-W" class="xref">Section 4.1</a>).<a href="#section-3.1-3.1" class="pilcrow">¶</a>
</li>
<li id="section-3.1-3.2">Location information about the authorization server (LOC_W), e.g. its domain name. This information may be available in the device certificate Cert(PK_U).<a href="#section-3.1-3.2" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
<div id="domain-authenticator">
<section id="section-3.2">
        <h3 id="name-domain-authenticator">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-domain-authenticator" class="section-name selfRef">Domain Authenticator</a>
        </h3>
<p id="section-3.2-1">The domain authenticator has a private key and corresponding public key PK_V used to authenticate to the device.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">The domain authenticator needs to be able to locate the authorization server of the device for which the LOC_W is expected to be sufficient. The communication between domain authenticator and authorization server is mutually authenticated and protected. Authentication credentials used with the authorization server are out of scope. How this communication is established and secured (typically TLS) is out of scope.<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2-3">TODO: Need for channel binding?<a href="#section-3.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authorization-server">
<section id="section-3.3">
        <h3 id="name-authorization-server">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-authorization-server" class="section-name selfRef">Authorization Server</a>
        </h3>
<p id="section-3.3-1">The authorization server has a private DH key corresponding to G_W, which is used to secure the communication with the device (see <a href="#U-W" class="xref">Section 4.1</a>). Authentication credentials and communication security used with the domain authenticator is out of scope.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2">The authorization server provides the authorization decision for enrolment to the device in the form of a CBOR encoded voucher. The authorization server provides information to the domain authenticator about the device, such as the the device's certificate Cert(PK_U).<a href="#section-3.3-2" class="pilcrow">¶</a></p>
<p id="section-3.3-3">The authorization server needs to be available during the execution of the protocol.<a href="#section-3.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="lightweight-ake">
<section id="section-3.4">
        <h3 id="name-lightweight-ake">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-lightweight-ake" class="section-name selfRef">Lightweight AKE</a>
        </h3>
<p id="section-3.4-1">We assume a Diffie-Hellman key exchange protocol complying with the LAKE requirements <span>[<a href="#I-D.ietf-lake-reqs" class="xref">I-D.ietf-lake-reqs</a>]</span>. Specifically we assume for the LAKE:<a href="#section-3.4-1" class="pilcrow">¶</a></p>
<ul>
<li id="section-3.4-2.1">Three messages<a href="#section-3.4-2.1" class="pilcrow">¶</a>
</li>
<li id="section-3.4-2.2">CBOR encoding<a href="#section-3.4-2.2" class="pilcrow">¶</a>
</li>
<li id="section-3.4-2.3">The ephemeral public Diffie-Hellman key of the device, G_X, is sent in message 1. G_X is also used as ephemeral key and nonce in the ECIES scheme between device and authorization server.<a href="#section-3.4-2.3" class="pilcrow">¶</a>
</li>
<li id="section-3.4-2.4">The static public key of the domain authenticator, PK_V, sent in message 2<a href="#section-3.4-2.4" class="pilcrow">¶</a>
</li>
<li id="section-3.4-2.5">Support for Auxilliary Data AD1-3 in messages 1-3 as specified in section 2.5 of <span>[<a href="#I-D.ietf-lake-reqs" class="xref">I-D.ietf-lake-reqs</a>]</span>.<a href="#section-3.4-2.5" class="pilcrow">¶</a>
</li>
<li id="section-3.4-2.6">Cipher suite negotiation where the device can propose ECDH curves restricted by its available public keys of the authorization server.<a href="#section-3.4-2.6" class="pilcrow">¶</a>
</li>
</ul>
</section>
</div>
</section>
</div>
<div id="the-protocol">
<section id="section-4">
      <h2 id="name-the-protocol">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-the-protocol" class="section-name selfRef">The Protocol</a>
      </h2>
<p id="section-4-1">Three security sessions are going on in parallel (see figure <a href="#fig-protocol" class="xref">Figure 2</a>):<a href="#section-4-1" class="pilcrow">¶</a></p>
<ul>
<li id="section-4-2.1">Between device and (domain) authenticator,<a href="#section-4-2.1" class="pilcrow">¶</a>
</li>
<li id="section-4-2.2">between authenticator and authorization server, and<a href="#section-4-2.2" class="pilcrow">¶</a>
</li>
<li id="section-4-2.3">between device and authorization server mediated by the authenticator.<a href="#section-4-2.3" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-4-3">We study each in turn, starting with the last.<a href="#section-4-3" class="pilcrow">¶</a></p>
<span id="name-the-protocol-2"></span><div id="fig-protocol">
<figure id="figure-2">
        <div class="artwork art-text alignCenter" id="section-4-4.1">
<pre>
   U                                 V                     W
   |                                 |                     |
   |--- Message 1 incl. G_X, AD1 ---&gt;|--- Voucher Req. ---&gt;|
   |                                 |                     |
   |&lt;-- Message 2 incl. PK_V, AD2 ---|&lt;-- Voucher Resp. ---|
   |                                 |
   |--- Message 3 incl. AD3 --------&gt;|

</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-the-protocol-2" class="selfRef">The Protocol</a>
        </figcaption></figure>
</div>
<div id="U-W">
<section id="section-4.1">
        <h3 id="name-device-authorization-server">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-device-authorization-server" class="section-name selfRef">Device &lt;-&gt; Authorization Server</a>
        </h3>
<p id="section-4.1-1">The communication between device and authorization server is carried out via the authenticator protected between the endpoints using an ECIES hybrid encryption scheme (see <span>[<a href="#I-D.irtf-cfrg-hpke" class="xref">I-D.irtf-cfrg-hpke</a>]</span>): The device uses the private key of its ephemeral DH key G_X generated for LAKE message 1 (see <a href="#U-V" class="xref">Section 4.2</a>) together with the static public DH key of the authorization server G_W to generate a shared secret G_XW. The shared secret is used to derive AEAD encryption keys to protect data between device and authorization server. The data is carried in AD1 and AD2 (between device and authenticator) and in voucher request/response (between authenticator and authorization server).<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">TODO: Reference relevant ECIES scheme in <span>[<a href="#I-D.irtf-cfrg-hpke" class="xref">I-D.irtf-cfrg-hpke</a>]</span>.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1-3">TODO: Define derivation of encryption keys (k_rq, k_rs) and nonces (n_rq, n_rs) for both directions<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1-4">AD1 SHALL be the following CBOR sequence containing voucher information:<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1-5">
<pre>
AD1 = (
    LOC_W:           tstr,
    CC:              bstr,
    CIPHERTEXT_RQ:   bstr
)
</pre><a href="#section-4.1-5" class="pilcrow">¶</a>
</div>
<p id="section-4.1-6">where<a href="#section-4.1-6" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.1-7.1">LOC_W is location information about the authorization server<a href="#section-4.1-7.1" class="pilcrow">¶</a>
</li>
<li id="section-4.1-7.2">CC is a crypto context identifier for the security context between the device and the authorization server<a href="#section-4.1-7.2" class="pilcrow">¶</a>
</li>
<li id="section-4.1-7.3">'CIPHERTEXT_RQ' is the authenticated encrypted identity of the device with CC as Additional Data, more specifically:<a href="#section-4.1-7.3" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-4.1-8">'CIPHERTEXT_RQ' is 'ciphertext' of COSE_Encrypt0 (Section 5.2-5.3 of <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span>) computed from the following:<a href="#section-4.1-8" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.1-9.1">the secret key k_rq<a href="#section-4.1-9.1" class="pilcrow">¶</a>
</li>
<li id="section-4.1-9.2">the nonce n_rq<a href="#section-4.1-9.2" class="pilcrow">¶</a>
</li>
<li id="section-4.1-9.3">'protected' is a byte string of size 0<a href="#section-4.1-9.3" class="pilcrow">¶</a>
</li>
<li id="section-4.1-9.4">'plaintext and 'external_aad' as below:<a href="#section-4.1-9.4" class="pilcrow">¶</a>
</li>
</ul>
<div class="artwork art-text alignLeft" id="section-4.1-10">
<pre>
plaintext = (
    ID:              bstr
 )
</pre><a href="#section-4.1-10" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-4.1-11">
<pre>
external_aad = (
    CC:              bstr
 )
</pre><a href="#section-4.1-11" class="pilcrow">¶</a>
</div>
<p id="section-4.1-12">where<a href="#section-4.1-12" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.1-13.1">ID is the identity of the device, for example a reference or pointer to the device certificate<a href="#section-4.1-13.1" class="pilcrow">¶</a>
</li>
<li id="section-4.1-13.2">CC is defined above.<a href="#section-4.1-13.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-4.1-14">AD2 SHALL be a CBOR sequence of one item, the Voucher, defined in the next section.<a href="#section-4.1-14" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1-15">
<pre>
AD2 = (
    Voucher:        bstr
)
</pre><a href="#section-4.1-15" class="pilcrow">¶</a>
</div>
<div id="voucher">
<section id="section-4.1.1">
          <h4 id="name-voucher">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-voucher" class="section-name selfRef">Voucher</a>
          </h4>
<p id="section-4.1.1-1">The Voucher is essentially a Message Authentication Code binding the identity of the authenticator to the first message sent from the device in the LAKE protocol.<a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1.1-2">More specifically 'Voucher' is the 'ciphertext' of COSE_Encrypt0 (Section 5.2 of <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span>) computed from the the following:<a href="#section-4.1.1-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.1.1-3.1">the secret key k_rs<a href="#section-4.1.1-3.1" class="pilcrow">¶</a>
</li>
<li id="section-4.1.1-3.2">the nonce n_rs<a href="#section-4.1.1-3.2" class="pilcrow">¶</a>
</li>
<li id="section-4.1.1-3.3">'protected' is a byte string of size 0<a href="#section-4.1.1-3.3" class="pilcrow">¶</a>
</li>
<li id="section-4.1.1-3.4">'plaintext' is empty (plaintext =  nil)<a href="#section-4.1.1-3.4" class="pilcrow">¶</a>
</li>
<li id="section-4.1.1-3.5">'external_aad' as below:<a href="#section-4.1.1-3.5" class="pilcrow">¶</a>
</li>
</ul>
<div class="artwork art-text alignLeft" id="section-4.1.1-4">
<pre>
external_aad = bstr .cbor external_aad_arr
</pre><a href="#section-4.1.1-4" class="pilcrow">¶</a>
</div>
<div class="artwork art-text alignLeft" id="section-4.1.1-5">
<pre>
external_aad_arr = [
    voucher_type:  int,
    PK_V:          bstr,
    G_X:           bstr,
    CC:            bstr,
    ID:            bstr
]
</pre><a href="#section-4.1.1-5" class="pilcrow">¶</a>
</div>
<p id="section-4.1.1-6">where<a href="#section-4.1.1-6" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.1.1-7.1">'voucher-type' indicates the kind of voucher used<a href="#section-4.1.1-7.1" class="pilcrow">¶</a>
</li>
<li id="section-4.1.1-7.2">
              <p id="section-4.1.1-7.2.1">PK_V is a COSE_Key containing the public authentication key of the authenticator. The public key must be an Elliptic Curve Diffie-Hellman key, COSE key type 'kty' = 'EC2' or 'OKP'.<a href="#section-4.1.1-7.2.1" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.1.1-7.2.2.1">COSE_Keys of type OKP SHALL only include the parameters 1 (kty), -1 (crv), and -2 (x-coordinate). COSE_Keys of type EC2 SHALL only include the parameters 1 (kty), -1 (crv), -2 (x-coordinate), and -3 (y-coordinate). The parameters SHALL be encoded in decreasing order.<a href="#section-4.1.1-7.2.2.1" class="pilcrow">¶</a>
</li>
</ul>
</li>
<li id="section-4.1.1-7.3">G_X is the ephemeral key of the device sent in the first LAKE message<a href="#section-4.1.1-7.3" class="pilcrow">¶</a>
</li>
<li id="section-4.1.1-7.4">CC and ID are defined in <a href="#U-W" class="xref">Section 4.1</a><a href="#section-4.1.1-7.4" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-4.1.1-8">All parameters, except 'voucher-type', are as received in the voucher request (see <a href="#V-W" class="xref">Section 4.3</a>).<a href="#section-4.1.1-8" class="pilcrow">¶</a></p>
<p id="section-4.1.1-9">TODO: Consider making the voucher a CBOR Map to indicate type of voucher, to indicate the feature (cf. <a href="#V-W" class="xref">Section 4.3</a>)<a href="#section-4.1.1-9" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="U-V">
<section id="section-4.2">
        <h3 id="name-device-authenticator">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-device-authenticator" class="section-name selfRef">Device &lt;-&gt; Authenticator</a>
        </h3>
<p id="section-4.2-1">The device and authenticator run the LAKE protocol authenticated with public keys (PK_U and PK_V) of the device and the authenticator. The normal processing of the LAKE is omitted here.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<div id="message-1">
<section id="section-4.2.1">
          <h4 id="name-message-1">
<a href="#section-4.2.1" class="section-number selfRef">4.2.1. </a><a href="#name-message-1" class="section-name selfRef">Message 1</a>
          </h4>
<div id="device-processing">
<section id="section-4.2.1.1">
            <h5 id="name-device-processing">
<a href="#section-4.2.1.1" class="section-number selfRef">4.2.1.1. </a><a href="#name-device-processing" class="section-name selfRef">Device processing</a>
            </h5>
<p id="section-4.2.1.1-1">The device selects a cipher suite with an ECDH curve satisfying the static public DH key G_W of the authorization server. As part of the normal LAKE processing, the device generates the ephemeral public key G_X to be sent in LAKE message 1. A new G_X MUST be generated for each execution of the protocol. The same ephemeral key is used in the ECIES scheme, see <a href="#U-W" class="xref">Section 4.1</a>.<a href="#section-4.2.1.1-1" class="pilcrow">¶</a></p>
<p id="section-4.2.1.1-2">The device sends LAKE message 1 with AD1 as specified in <a href="#U-W" class="xref">Section 4.1</a>.<a href="#section-4.2.1.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authenticator-processing">
<section id="section-4.2.1.2">
            <h5 id="name-authenticator-processing">
<a href="#section-4.2.1.2" class="section-number selfRef">4.2.1.2. </a><a href="#name-authenticator-processing" class="section-name selfRef">Authenticator processing</a>
            </h5>
<p id="section-4.2.1.2-1">The authenticator receives LAKE message 1 from the device, which triggers the exchange of voucher related data with the authorization server as described in <a href="#V-W" class="xref">Section 4.3</a>.<a href="#section-4.2.1.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="message-2">
<section id="section-4.2.2">
          <h4 id="name-message-2">
<a href="#section-4.2.2" class="section-number selfRef">4.2.2. </a><a href="#name-message-2" class="section-name selfRef">Message 2</a>
          </h4>
<div id="authenticator-processing-1">
<section id="section-4.2.2.1">
            <h5 id="name-authenticator-processing-2">
<a href="#section-4.2.2.1" class="section-number selfRef">4.2.2.1. </a><a href="#name-authenticator-processing-2" class="section-name selfRef">Authenticator processing</a>
            </h5>
<p id="section-4.2.2.1-1">The authenticator sends LAKE message 2 to the device with the voucher (see <a href="#U-W" class="xref">Section 4.1</a>) in AD2. The public key PK_V is encoded in the way public keys are encoded in the LAKE protocol.<a href="#section-4.2.2.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="device-processing-1">
<section id="section-4.2.2.2">
            <h5 id="name-device-processing-2">
<a href="#section-4.2.2.2" class="section-number selfRef">4.2.2.2. </a><a href="#name-device-processing-2" class="section-name selfRef">Device processing</a>
            </h5>
<p id="section-4.2.2.2-1">The device MUST verify the Voucher using its ephemeral key G_X sent in message 1 and PK_V received in message 2. If the Voucher does not verify, the device MUST discontinue the protocol.<a href="#section-4.2.2.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="message-3">
<section id="section-4.2.3">
          <h4 id="name-message-3">
<a href="#section-4.2.3" class="section-number selfRef">4.2.3. </a><a href="#name-message-3" class="section-name selfRef">Message 3</a>
          </h4>
<div id="device-processing-2">
<section id="section-4.2.3.1">
            <h5 id="name-device-processing-3">
<a href="#section-4.2.3.1" class="section-number selfRef">4.2.3.1. </a><a href="#name-device-processing-3" class="section-name selfRef">Device processing</a>
            </h5>
<p id="section-4.2.3.1-1">The device sends message 3. AD3 depends on the kind of enrolment the device is requesting. It may e.g. be a CBOR encoded Certificate Signing Request, see <span>[<a href="#I-D.raza-ace-cbor-certificates" class="xref">I-D.raza-ace-cbor-certificates</a>]</span>.<a href="#section-4.2.3.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authenticator-processing-2">
<section id="section-4.2.3.2">
            <h5 id="name-authenticator-processing-3">
<a href="#section-4.2.3.2" class="section-number selfRef">4.2.3.2. </a><a href="#name-authenticator-processing-3" class="section-name selfRef">Authenticator processing</a>
            </h5>
<p id="section-4.2.3.2-1">The authenticator receives message 3.<a href="#section-4.2.3.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="V-W">
<section id="section-4.3">
        <h3 id="name-authenticator-authorization">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-authenticator-authorization" class="section-name selfRef">Authenticator &lt;-&gt; Authorization Server</a>
        </h3>
<p id="section-4.3-1">The authenticator and authorization server are assumed to have secure communication, for example based on TLS authenticated with certificates.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<div id="voucher-request">
<section id="section-4.3.1">
          <h4 id="name-voucher-request">
<a href="#section-4.3.1" class="section-number selfRef">4.3.1. </a><a href="#name-voucher-request" class="section-name selfRef">Voucher Request</a>
          </h4>
<p id="section-4.3.1-1">The authenticator sends the voucher request to the authorization server.
The Voucher_Request SHALL be a CBOR array as defined below:<a href="#section-4.3.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.3.1-2">
<pre>
Voucher_Request = [
    PK_V:            bstr,
    G_X:             bstr,
    CC:              bstr,
    CIPHERTEXT_RQ:   bstr
]
</pre><a href="#section-4.3.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.3.1-3">where the parameters are defined in <a href="#U-W" class="xref">Section 4.1</a>.<a href="#section-4.3.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="voucher-response">
<section id="section-4.3.2">
          <h4 id="name-voucher-response">
<a href="#section-4.3.2" class="section-number selfRef">4.3.2. </a><a href="#name-voucher-response" class="section-name selfRef">Voucher Response</a>
          </h4>
<p id="section-4.3.2-1">The authorization server decrypts the identity of the device and looks up its certificate, Cert(PK_U). The authorization server sends the voucher response to the authenticator. The Voucher_Response SHALL be a CBOR array as defined below:<a href="#section-4.3.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.3.2-2">
<pre>
Voucher_Response = [
    CERT_PK_U:      bstr,
    Voucher:        bstr
]
</pre><a href="#section-4.3.2-2" class="pilcrow">¶</a>
</div>
<p id="section-4.3.2-3">where<a href="#section-4.3.2-3" class="pilcrow">¶</a></p>
<ul>
<li id="section-4.3.2-4.1">CERT_PK_U is the device certificate of the public key PK_U, issued by a trusted third party, intended to be verified by the authenticator. The format of this certificate is out of scope.<a href="#section-4.3.2-4.1" class="pilcrow">¶</a>
</li>
<li id="section-4.3.2-4.2">Voucher is defined in <a href="#U-W" class="xref">Section 4.1</a><a href="#section-4.3.2-4.2" class="pilcrow">¶</a>
</li>
</ul>
<p id="section-4.3.2-5">TODO: The voucher response may contain a "Voucher-info" field as an alternative to make the Voucher a CBOR Map (see <a href="#U-W" class="xref">Section 4.1</a>)<a href="#section-4.3.2-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="ace-profile">
<section id="section-5">
      <h2 id="name-ace-profile">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-ace-profile" class="section-name selfRef">ACE Profile</a>
      </h2>
<p id="section-5-1">This section defines the profile of the ACE framework (see Appendix C of <span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>).<a href="#section-5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-cons">
<section id="section-6">
      <h2 id="name-security-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-6-1">TODO: Identity protection of device<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">TODO: How can the authorization server attest the received PK_V?<a href="#section-6-2" class="pilcrow">¶</a></p>
<p id="section-6-3">TODO: Use of G_X as ephemeral key between device and authenticator, and between device and authorization server<a href="#section-6-3" class="pilcrow">¶</a></p>
<p id="section-6-4">TODO: Remote attestation<a href="#section-6-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana">
<section id="section-7">
      <h2 id="name-iana-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-7-1">TODO: CC registry<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">TODO: Voucher type registry<a href="#section-7-2" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-8">
      <h2 id="name-informative-references">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
      </h2>
<dl class="references">
<dt id="I-D.ietf-6tisch-minimal-security">[I-D.ietf-6tisch-minimal-security]</dt>
<dd>
<span class="refAuthor">Vucinic, M.</span><span class="refAuthor">, Simon, J.</span><span class="refAuthor">, Pister, K.</span><span class="refAuthor">, and M. Richardson</span>, <span class="refTitle">"Constrained Join Protocol (CoJP) for 6TiSCH"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-6tisch-minimal-security-15</span>, <time datetime="2019-12-10">10 December 2019</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-6tisch-minimal-security-15.txt">http://www.ietf.org/internet-drafts/draft-ietf-6tisch-minimal-security-15.txt</a>&gt;</span>. </dd>
<dt id="I-D.ietf-ace-coap-est">[I-D.ietf-ace-coap-est]</dt>
<dd>
<span class="refAuthor">Stok, P.</span><span class="refAuthor">, Kampanakis, P.</span><span class="refAuthor">, Richardson, M.</span><span class="refAuthor">, and S. Raza</span>, <span class="refTitle">"EST over secure CoAP (EST-coaps)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-coap-est-18</span>, <time datetime="2020-01-06">6 January 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-ace-coap-est-18.txt">http://www.ietf.org/internet-drafts/draft-ietf-ace-coap-est-18.txt</a>&gt;</span>. </dd>
<dt id="I-D.ietf-ace-oauth-authz">[I-D.ietf-ace-oauth-authz]</dt>
<dd>
<span class="refAuthor">Seitz, L.</span><span class="refAuthor">, Selander, G.</span><span class="refAuthor">, Wahlstroem, E.</span><span class="refAuthor">, Erdtman, S.</span><span class="refAuthor">, and H. Tschofenig</span>, <span class="refTitle">"Authentication and Authorization for Constrained Environments (ACE) using the OAuth 2.0 Framework (ACE-OAuth)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-oauth-authz-33</span>, <time datetime="2020-02-06">6 February 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-ace-oauth-authz-33.txt">http://www.ietf.org/internet-drafts/draft-ietf-ace-oauth-authz-33.txt</a>&gt;</span>. </dd>
<dt id="I-D.ietf-lake-reqs">[I-D.ietf-lake-reqs]</dt>
<dd>
<span class="refAuthor">Vucinic, M.</span><span class="refAuthor">, Selander, G.</span><span class="refAuthor">, Mattsson, J.</span><span class="refAuthor">, and D. Garcia-Carillo</span>, <span class="refTitle">"Requirements for a Lightweight AKE for OSCORE"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-lake-reqs-01</span>, <time datetime="2020-02-19">19 February 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-lake-reqs-01.txt">http://www.ietf.org/internet-drafts/draft-ietf-lake-reqs-01.txt</a>&gt;</span>. </dd>
<dt id="I-D.irtf-cfrg-hpke">[I-D.irtf-cfrg-hpke]</dt>
<dd>
<span class="refAuthor">Barnes, R.</span><span class="refAuthor"> and K. Bhargavan</span>, <span class="refTitle">"Hybrid Public Key Encryption"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-hpke-02</span>, <time datetime="2019-11-04">4 November 2019</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-irtf-cfrg-hpke-02.txt">http://www.ietf.org/internet-drafts/draft-irtf-cfrg-hpke-02.txt</a>&gt;</span>. </dd>
<dt id="I-D.raza-ace-cbor-certificates">[I-D.raza-ace-cbor-certificates]</dt>
<dd>
<span class="refAuthor">Raza, S.</span><span class="refAuthor">, Hoglund, J.</span><span class="refAuthor">, Selander, G.</span><span class="refAuthor">, Mattsson, J.</span><span class="refAuthor">, and M. Furuhed</span>, <span class="refTitle">"CBOR Profile of X.509 Certificates"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-raza-ace-cbor-certificates-03</span>, <time datetime="2019-12-20">20 December 2019</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-raza-ace-cbor-certificates-03.txt">http://www.ietf.org/internet-drafts/draft-raza-ace-cbor-certificates-03.txt</a>&gt;</span>. </dd>
<dt id="RFC2119">[RFC2119]</dt>
<dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dt id="RFC3748">[RFC3748]</dt>
<dd>
<span class="refAuthor">Aboba, B.</span><span class="refAuthor">, Blunk, L.</span><span class="refAuthor">, Vollbrecht, J.</span><span class="refAuthor">, Carlson, J.</span><span class="refAuthor">, and H. Levkowetz, Ed.</span>, <span class="refTitle">"Extensible Authentication Protocol (EAP)"</span>, <span class="seriesInfo">RFC 3748</span>, <span class="seriesInfo">DOI 10.17487/RFC3748</span>, <time datetime="2004-06">June 2004</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3748">https://www.rfc-editor.org/info/rfc3748</a>&gt;</span>. </dd>
<dt id="RFC7228">[RFC7228]</dt>
<dd>
<span class="refAuthor">Bormann, C.</span><span class="refAuthor">, Ersue, M.</span><span class="refAuthor">, and A. Keranen</span>, <span class="refTitle">"Terminology for Constrained-Node Networks"</span>, <span class="seriesInfo">RFC 7228</span>, <span class="seriesInfo">DOI 10.17487/RFC7228</span>, <time datetime="2014-05">May 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7228">https://www.rfc-editor.org/info/rfc7228</a>&gt;</span>. </dd>
<dt id="RFC8152">[RFC8152]</dt>
<dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refTitle">"CBOR Object Signing and Encryption (COSE)"</span>, <span class="seriesInfo">RFC 8152</span>, <span class="seriesInfo">DOI 10.17487/RFC8152</span>, <time datetime="2017-07">July 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8152">https://www.rfc-editor.org/info/rfc8152</a>&gt;</span>. </dd>
<dt id="RFC8174">[RFC8174]</dt>
<dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
</dl>
</section>
<div id="authors-addresses">
<section id="section-appendix.a">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Göran Selander</span></div>
<div dir="auto" class="left"><span class="org">Ericsson AB</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:goran.selander@ericsson.com" class="email">goran.selander@ericsson.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">John Mattsson</span></div>
<div dir="auto" class="left"><span class="org">Ericsson AB</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:john.mattsson@ericsson.com" class="email">john.mattsson@ericsson.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Malisa Vucinic</span></div>
<div dir="auto" class="left"><span class="org">INRIA</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:malisa.vucinic@inria.fr" class="email">malisa.vucinic@inria.fr</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Michael Richardson</span></div>
<div dir="auto" class="left"><span class="org">Sandelman Software Works</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:mcr+ietf@sandelman.ca" class="email">mcr+ietf@sandelman.ca</a>
</div>
</address>
</section>
</div>
<script>var toc = document.getElementById("toc");
var tocToggle = toc.querySelector("h2");
var tocNav = toc.querySelector("nav");

// mobile menu toggle
tocToggle.onclick = function(event) {
    if (window.innerWidth < 1024) {
 var tocNavDisplay = tocNav.currentStyle ? tocNav.currentStyle.display : getComputedStyle(tocNav, null).display;
 if (tocNavDisplay == "none") {
     tocNav.style.display = "block";
 } else {
     tocNav.style.display = "none";
 }
    }
}

// toc anchor scroll to anchor
tocNav.addEventListener("click", function (event) {
    event.preventDefault();
    if (event.target.nodeName == 'A') {
 if (window.innerWidth < 1024) {
     tocNav.style.display = "none";
 }
 var href = event.target.getAttribute("href");
 var anchorId = href.substr(1);
 var anchor =  document.getElementById(anchorId);
 anchor.scrollIntoView(true);
 window.history.pushState("","",href);
    }
});

// switch toc mode when window resized
window.onresize = function () {
    if (window.innerWidth < 1024) {
 tocNav.style.display = "none";
    } else {
 tocNav.style.display = "block";
    }
}
</script>
</body>
</html>
